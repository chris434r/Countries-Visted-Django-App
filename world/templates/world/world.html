<!DOCTYPE html>

<html>
<head>
    {% load static %}
    {% load leaflet_tags %}
    {% leaflet_js %}
    {% leaflet_css %}

    <script type='text/javascript' src='{% static ' dist
    /leaflet.ajax.js' %}' > </script>
    <link rel="stylesheet" type = "text/css" href ='{% static 'css/style.css' %}' > </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


    <link rel="stylesheet" href="https://labs.easyblog.it/maps/leaflet-search/src/leaflet-search.css"/>


    <style type="text/css">

      #findbox {
	background: #eee;
	border-radius:.125em;
	border:2px solid #1978cf;
	box-shadow: 0 0 8px #999;
	margin-bottom: 10px;
	padding: 2px 0;
	width: 600px;
	height: 26px;
}
.search-tooltip {
	width: 200px;
}
.leaflet-control-search .search-cancel {
	position: static;
	float: left;
	margin-left: -22px;
}
         #map {width:50%;height:650px;}

          ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}


    </style>
</head>


<body>
<p style="text-align:center; font-size: 24px; color:#175B81; font-weight:bold; "
<h3> My World Map
    <h3>

        <div id="findbox"></div>


        <div id="map" style="height: 680px; width: 48%;display: "></div>


        <div class="sidebar" style='display: right;'
        <p style="text-align:centre;font-size: 24px; color:#175B81; font-weight:bold; "> My Flags:</p>


        <table style="width:90%">
            <tr>

                <td id='name' hidden></td>
                <td id='code' hidden></td>


            </tr>
            <tr>
                <ul id="Countries_Visted">

                    <li></li>
                </ul>
                </div>

</body>

<br>

<script>


    var img1 =   "<img src="
    var im2 = ">"

    var quotes = "'"
    var flagimage_pt1 = "https://www.countryflags.io/"
    var flagimage_pt2= "/flat/64.png"

    // creating mapbox basemap


     var mapboxAccessToken = 'pk.eyJ1IjoiY2hyaXNyeWFuLXRlY2giLCJhIjoiY2thY2c3bDZyMDZsNDJ4cHJlZmhwZmFjaCJ9.3GuHRvRz-8fxi4r103z05w'
     var mapbox = L.map('map').setView([46.0, 8.0], 2.2);
     mapbox.doubleClickZoom.disable();


     L.tileLayer('https://api.mapbox.com/styles/v1/chrisryan-tech/ckaxvc0bt10041iqfz5fb7dgj/tiles/256/{z}/{x}/{y}@2x?access_token=' + mapboxAccessToken, {
        tileSize: 512,
        zoomOffset: -1,
        attribution: '© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'

         }).addTo(mapbox);

      // style for vector layers

      var countriesstyle = {
      "color": '#636363',
      "weight": 1,
      "opacity": 7};


       //loading data with style, click function and listener

        var  layer = new L.GeoJSON.AJAX("{% url 'borders_data' %}",{
				    style : countriesStyle,
					onEachFeature : countriesOnEachFeature
				})
        //listener - adding to map on load
        layer.on('data:loaded',function(e){layer.addTo(mapbox)
         });

       // creating click interaction

     var countriesLayer;

     	function highlightFeature(e){
				var layer = e.target;
				layer.setStyle(
					{
						weight : 5,
						color : 'black',
						fillColor : 'green',
						fillOpacity : 0.2
					}
				);
				if(!L.Browser.ie && !L.Browser.opera){
					layer.bringToFront();
				}
			}

			function resetHighlight(e){
				countriesLayer.resetStyle(e.target);
			}

			function zoomToFeature(e){
				map.fitBounds(e.target.getBounds());
			}


			function countriesStyle(feature){
				return {
					fillColor : 'grey',
					weight : 2,
					opacity : 0.2,
					color : 'grey',
					dashArray : 3,
					fillOpacity : 0.2
				}
			}



			function countriesOnEachFeature(feature, layer){
				layer.on(
					{

						click: function(e){
                      var layer = e.target;
                      layer.setStyle({
                      weight: 1,
                      color: '#fff',
                      dashArray: '',
                      fillOpacity: 0.9,
                      fillColor: 'green'
                       });
                       if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                       layer.bringToFront();
                        }
                         }
                         });

                          layer.on(
					{

						click: load_name});

						layer.on(
					{

						click: load_flag});

						  layer.on(
					{

						dblclick: clear});
                         }


                         layer.on(
					{

						dblclick: removeElement});




                     function clear (e) {
            countriesLayer.resetStyle(e.target); field2.parentNode.removeChild(element);
             }

             function load_name (e) {
              var field1 =document.getElementById('name');
                field1.innerHTML= e.target.feature.properties.name;

                var selected_flag_click = field1.innerHTML
                $('#Countries_Visted').append('<li>'+selected_flag_click+'</li>').disabled = true


             }

                function load_flag (e) {
                var field2 =document.getElementById('code');
                field2.innerHTML= e.target.feature.properties.iso2;

                var selected_name_click = img1+quotes+flagimage_pt1+field2.innerHTML+flagimage_pt2+quotes+im2
                $('#Countries_Visted').append('<li>'+selected_name_click+'</li>').disabled = true

                 Countries_Visted.onclick = function() {this.parentNode.removeChild(this);}
                 Countries_Visted.ondblclick = removeElement


                 }




                 function removeElement(elementId) {
                 element =document.getElementById('code');
                 field2.parentNode.removeChild(element);
                 }


			$("#addButton").click(function () {
            $('ul').append('<li>'+selectedVal+'</li>')


              });



</script>

<!- search box functionality - searches attribute data -->
<!- contained within Geojson from loaded event listener -->


<script src="https://unpkg.com/leaflet@1.3.0/dist/leaflet.js"></script>
<script src="https://labs.easyblog.it/maps/leaflet-search/src/leaflet-search.js"></script>

<script>

        //pointing search function to map layer

	 	var searchControl = new L.Control.Search({
        container: 'findbox',
		layer: layer,
		initial: false,
		collapsed: false,
		propertyName: 'name',
		marker: false
	    });



	searchControl.on('search:locationfound', function(e) {

		//console.log('search:locationfound', );
		e.layer.setStyle({fillColor: 'green', color: 'black',fillOpacity: 0.8});
              var field1 =document.getElementById('name');
                field1.innerHTML= e.layer.feature.properties.name;
                var field2 =document.getElementById('code');
                field2.innerHTML= e.layer.feature.properties.iso2;

                var selected_name_search = field1.innerHTML
                $('#Countries_Visted').append('<li>'+selected_name_search+'</li>').disabled = true

                var selected_flag_search = img1+quotes+flagimage_pt1+field2.innerHTML+flagimage_pt2+quotes+im2
                $('#Countries_Visted').append('<li>'+selected_flag_search+'</li>').disabled = true
	});


	;

		$("#addButton").click(function () {
        $('ul').append('<li>'+selectedVal+'</li>')

        });



	mapbox.addControl( searchControl );  //inizialize search control




</script>

</html>